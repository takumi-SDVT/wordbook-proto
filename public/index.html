<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>単語帳AI</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #111827;
      --text: #e5e7eb;
      --border: #1f2937;
      --accent: #22c55e;
      --muted: #94a3b8;
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    .container { max-width: 720px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 24px; font-weight: 700; margin-bottom: 16px; }
    .form { display: grid; gap: 12px; margin-bottom: 24px; }
    label { font-size: 14px; color: var(--muted); margin-bottom: 4px; }
    input, select { 
      width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); 
      background: var(--card); color: var(--text); font-size: 16px; outline: none; 
    }
    button { 
      padding: 10px; border-radius: 8px; border: none; background: var(--accent); 
      color: #052812; font-weight: 700; cursor: pointer; 
    }
    button:hover { background: #16a34a; }
    .result { margin-top: 24px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
    th { background: var(--card); font-weight: 700; }
    td { background: var(--bg); }
    .toast { 
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
      background: var(--card); color: var(--text); padding: 8px 16px; 
      border-radius: 8px; display: none; 
    }
    .toast.show { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <h1>単語帳AI</h1>
    <div class="form">
      <div>
        <label>お題</label>
        <input type="text" id="topic" placeholder="例：にじさんじライバー、古文単語">
      </div>
      <div>
        <label>説明（裏面）</label>
        <input type="text" id="backKind" placeholder="例：特徴、意味">
      </div>
      <div>
        <label>補足</label>
        <input type="text" id="extraKind" placeholder="例：エピソード、例文">
      </div>
      <div>
        <label>難易度</label>
        <input type="text" id="difficulty" placeholder="例：初心者向け、難関大レベル">
      </div>
      <div>
        <label>単語数</label>
        <input type="number" id="count" value="5" min="1" max="10">
      </div>
      <button onclick="generateDeck()">生成する</button>
    </div>
    <div class="result" id="result"></div>
    <div class="toast" id="toast"></div>
  </div>

  <script>
    async function generateDeck() {
      const topic = document.getElementById('topic').value.trim();
      const backKind = document.getElementById('backKind').value.trim();
      const extraKind = document.getElementById('extraKind').value.trim();
      const difficulty = document.getElementById('difficulty').value.trim();
      const count = parseInt(document.getElementById('count').value) || 5;

      if (!topic || !count) {
        showToast('お題と単語数を入力してください');
        return;
      }

      try {
        const res = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ topic, backKind, extraKind, difficulty, count })
        });
        const { cards, error } = await res.json();
        if (error) throw new Error(error);

        renderCards(cards);
        showToast('単語帳を生成しました');
      } catch (e) {
        console.error('Generate failed:', e);
        showToast('生成に失敗しました');
      }
    }

    function renderCards(cards) {
      const resultEl = document.getElementById('result');
      if (!cards || cards.length === 0) {
        resultEl.innerHTML = '<p>単語がありません</p>';
        return;
      }

      let html = `
        <table>
          <tr>
            <th>単語</th>
            <th>説明</th>
            <th>補足</th>
          </tr>
      `;
      for (const card of cards) {
        html += `
          <tr>
            <td>${escapeHTML(card.front)}</td>
            <td>${escapeHTML(card.back)}</td>
            <td>${escapeHTML(card.extra)}</td>
          </tr>
        `;
      }
      html += '</table>';
      resultEl.innerHTML = html;
    }

    function escapeHTML(s) {
      return String(s ?? '').replace(/[&<>"']/g, m => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', '\'': '&#39;'
      })[m]);
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }
  </script>
</body>
</html>